var weitherAPI="http://api.openweathermap.org/data/2.5/weather?appid=2de143494c0b295cca9337e1e96b00e0&lang=zh&callback=?&q=",transitionend="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd";$.fn.toShow=function(){return $(this).removeClass("hide").addClass("show")},$.fn.toHide=function(){return $(this).removeClass("show").addClass("hide")};var loadUserMsg=function(t){var e={},i=new Date;ipLoc=window.remote_ip_info,e.text=$(".edit #msg").val(),e.location=ipLoc.city||ipLoc.province||"北京",e.time=i.getMonth()+"/"+i.getDate();var n=weitherAPI+e.location;$.getJSON(n).success(function(t){return"404"==t.cod?(e.temp=0,void(e.weither="未知")):(e.temp=(t.main.temp-273.15).toFixed(0),void(e.weither=t.weather[0].description))}).fail(function(){e.temp="null"}).done(function(){t(e)})},init=function(){$("#msg").textareaAutoSize().focus(),$(".submit").click(function(t){t.preventDefault();var e=Cookies.get("user");return e||(e=window.prompt("你叫什么呢？（小于10个字符)",""),e||(e=window.prompt("别淘气，你叫啥？","")),e.length>10&&(e=window.prompt("名字太非主流不好（小于10个字符)",e)),Cookies.set("user",e,{expires:1e3,path:"/"})),$(".edit #msg").val()?($(this).addClass("circle"),void loadUserMsg(function(t){t.user=e,console.log(t),$(this).removeClass("circle"),$(".edit").toHide().one(transitionend,function(){$(this).unbind(transitionend).hide(),$(".preview").show().find("#prepre").text(t.text).end().find("#temp").text(t.weither).end().find("#time").text(t.time).end().find("#loc").text(t.location).end().find(".user span").text(t.user),setTimeout(function(){$(".preview").toShow()})})}.bind(this))):void alert("总得说点什么吧")}),$(".ret").click(function(){$(".preview").toHide().one(transitionend,function(){$(this).unbind(transitionend).hide(),$(".edit").show(),setTimeout(function(){$(".edit").toShow()})})})};$(function(){FastClick.attach(document.body),init()});