var weitherAPI="http://api.openweathermap.org/data/2.5/weather?appid=2de143494c0b295cca9337e1e96b00e0&lang=zh&callback=?&q=",transitionend="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",API={get:"http://5.vgee.sinaapp.com/s1/jsonp.php?callback=?",post:"http://5.vgee.sinaapp.com/s1/jsonpost.php?callback=?"},icons={"01":"&#xe604;","02":"&#xe603;","03":"&#xe606;","04":"&#xe601;","09":"&#xe600;",10:"&#xe607;",11:"&#xe602;",13:"&#xe608;",50:"&#xe605;"};$.fn.toShow=function(){return $(this).removeClass("hide").addClass("show")},$.fn.toHide=function(){return $(this).removeClass("show").addClass("hide")};var loadUserMsg=function(e){var t={},i=new Date;ipLoc=window.remote_ip_info,t.text=$(".edit #msg").val(),t.location=ipLoc.city||ipLoc.province||"北京",t.time=i.getMonth()+1+"/"+i.getDate();var n=weitherAPI+t.location;$.getJSON(n).success(function(e){return"404"==e.cod?(t.temp=0,void(t.weither="未知")):(t.temp=(e.main.temp-273.15).toFixed(0),t.weither=e.weather[0].description,void(t.w_icon=e.weather[0].icon.slice(0,2)))}).fail(function(){t.temp="未知"}).done(function(){e(t)})},userData,postData=function(){var e=userData.user,t=userData.text,i=userData.weither,n=userData.location;wall_w_icon=userData.w_icon;var o="&wall_author="+e+"&wall_message="+t+"&wall_weither="+i+"&wall_city="+n+"&wall_w_icon="+wall_w_icon;console.log(o),$.getJSON(API.post+o).success(function(e){e.success?window.location.href="list.html":alert(e)})},init=function(){$("#msg").textareaAutoSize().focus(),$(".submit").click(function(e){e.preventDefault();var t=Cookies.get("user");return t||(t=window.prompt("你叫什么呢？（小于10个字符)",""),t||(t=window.prompt("别淘气，你叫啥？","")),t.length>10&&(t=window.prompt("名字太非主流不好（小于10个字符)",t)),Cookies.set("user",t,{expires:1e3,path:"/"})),$(".edit #msg").val()?($(this).addClass("circle"),void loadUserMsg(function(e){e.user=t,userData=e,console.log(e),$(this).removeClass("circle"),$(".edit").toHide().one(transitionend,function(){$(this).unbind(transitionend).hide(),$(".preview").show().find("#prepre").text(e.text).end().find("#i-temp").html(icons[e.w_icon]).end().find("#temp").text(e.weither).end().find("#time").text(e.time).end().find("#loc").text(e.location).end().find(".user span").text(e.user).end(),setTimeout(function(){$(".preview").toShow()})})}.bind(this))):void alert("总得说点什么吧")}),$(".ret").click(function(){$(".preview").toHide().one(transitionend,function(){$(this).unbind(transitionend).hide(),$(".edit").show(),setTimeout(function(){$(".edit").toShow()})})}),$(".go").click(function(){postData()})};$(function(){FastClick.attach(document.body),init()});var test=function(){};